{% extends 'base.html' %}
{% load static %}

{% block title %}Solicitudes de Cotización{% endblock %}

{% block content %}

<style>
/* Reuse dark overrides from registro */
body { background-color: #000 !important; color: #fff !important; }
.content-area, .container-fluid { background: transparent; color: #fff !important; }
.form-control, .form-select, textarea { background-color: #111 !important; color:#fff !important; border:1px solid #333 !important; }
.table, .table th, .table td { color: #fff !important; border-color: rgba(255,255,255,0.05) !important; }
</style>
<div class="container py-4">
    <h1>Solicitudes de Cotización</h1>

    {% if solicitudes %}
        {% for s in solicitudes %}
            {% with c=s.cotizacion items=s.items subtotal=s.subtotal %}
            <div class="card mb-3">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <strong>#{{ c.id }}</strong> — {{ c.cliente.nombre }} <small class="text-muted">({{ c.cliente.correo }})</small>
                        <div class="small text-muted">Enviado: {{ c.creado }}</div>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-secondary">{{ c.estado }}</span>
                    </div>
                </div>
                <div class="card-body">
                    {% if c.mensaje %}
                        <p><strong>Mensaje:</strong> {{ c.mensaje }}</p>
                    {% endif %}

                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr><th>Producto</th><th>Cant.</th><th>Precio unit.</th><th>Total</th></tr>
                            </thead>
                            <tbody>
                                {% for it in items %}
                                <tr>
                                    <td>{{ it.producto.nombre }}</td>
                                    <td>{{ it.cantidad }}</td>
                                    <td>
                                        {% if it.precio_unitario %} ${{ it.precio_unitario }} {% else %} ${{ it.producto.precio }} {% endif %}
                                    </td>
                                    <td>
                                        {% with p=it.precio_unitario|default:it.producto.precio %}
                                            ${{ p|floatformat:2|add:"0" }} x {{ it.cantidad }} <!-- visual; subtotal calculado en vista -->
                                        {% endwith %}
                                    </td>
                                </tr>
                                {% endfor %}
                                <tr>
                                    <td colspan="3" class="text-end"><strong>Subtotal</strong></td>
                                    <td><strong>${{ subtotal|floatformat:2 }}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endwith %}
        {% endfor %}
    {% else %}
        <div class="alert alert-info">No hay solicitudes de cotización.</div>
    {% endif %}
</div>
{% endblock %}
